---
title: Security
description: Security features and best practices for the Wallet API
---

The Wallet API includes enterprise-grade security measures to protect your funds and data.

## Authentication

All API requests require an API key in the `X-API-Key` header. Keys must be at least 32 characters and are validated using constant-time comparison to prevent timing attacks.

```bash
curl https://api.yourdomain.com/api/v1/wallets \
  -H "X-API-Key: sk_live_your_64_char_key_here"
```

---

## Encryption

### Wallet Seed Protection

HD wallet seeds are encrypted at rest using:

- **Algorithm**: AES-256-GCM (authenticated encryption)
- **Key Derivation**: PBKDF2 with 100,000 iterations
- **Unique Salt**: Each encrypted value has its own random salt

Seeds are never stored in plaintext. If the encryption key is lost, wallet funds become inaccessible.

:::danger
Back up your `ENCRYPTION_KEY` securely. There is no recovery mechanism if lost.
:::

---

## Input Validation

All user inputs are strictly validated:

| Field | Validation |
|-------|------------|
| `chain` | Must be one of supported chain codes |
| `reference_id` | Must be valid UUID format |
| `name` | Blocks `<`, `>`, newlines, null bytes |
| `webhook.url` | Must be valid HTTPS URL, blocks internal IPs |
| `webhook.events` | Must be valid event types only |

Invalid input returns `422 Unprocessable Entity` with details.

---

## SSRF Protection

Webhook URLs are validated to prevent Server-Side Request Forgery:

### Blocked Hosts
- `localhost`, `127.0.0.1`, `0.0.0.0`, `::1`
- `metadata.google.internal`
- `169.254.169.254` (cloud metadata endpoints)

### Blocked IP Ranges
- `10.0.0.0/8` (private)
- `172.16.0.0/12` (private)
- `192.168.0.0/16` (private)
- `127.0.0.0/8` (loopback)
- `169.254.0.0/16` (link-local)
- IPv6 private and link-local ranges

### Additional Protections
- DNS resolution verified before sending webhooks
- HTTP redirects disabled
- 10 second timeout on all webhook requests

---

## Security Headers

All API responses include security headers:

```
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Cache-Control: no-store
X-Request-ID: <unique-id>
```

---

## Request Protection

- **Maximum body size**: 1MB
- **CORS**: Restricted to configured origins only
- **Allowed methods**: GET, POST, PUT, DELETE
- **Allowed headers**: Authorization, Content-Type, X-API-Key

---

## Webhook Security

Webhooks are signed with HMAC-SHA256 to verify authenticity.

### Signature Headers

| Header | Description |
|--------|-------------|
| `X-Wallet-Signature` | HMAC-SHA256 signature |
| `X-Wallet-Timestamp` | Unix timestamp of signature |
| `X-Wallet-Event` | Event type (e.g., `payment.confirmed`) |

### Signature Format

```
sha256=<hex_signature>
```

The signature is computed over `{timestamp}.{payload}` using your webhook secret.

### Verification Example

```python
import hmac
import hashlib

def verify_webhook(payload: bytes, signature: str, timestamp: str, secret: str) -> bool:
    expected = hmac.new(
        secret.encode(),
        f"{timestamp}.{payload.decode()}".encode(),
        hashlib.sha256
    ).hexdigest()

    return hmac.compare_digest(f"sha256={expected}", signature)
```

---

## Error Handling

In production mode (`DEBUG=false`):

- Internal errors return generic `500 Internal Server Error`
- Stack traces are never exposed to clients
- Full error details are logged server-side only

---

## Best Practices

### 1. Use HTTPS Only

Always deploy behind TLS. Terminate SSL at your load balancer or reverse proxy.

### 2. Secure Environment Variables

```bash
# Generate strong secrets
API_KEY=$(openssl rand -hex 32)
ENCRYPTION_KEY=$(openssl rand -hex 32)
POSTGRES_PASSWORD=$(openssl rand -hex 16)
```

### 3. Restrict CORS Origins

```env
CORS_ORIGINS=["https://yourdomain.com"]
```

### 4. Monitor Rate Limits

Watch for `429` responses in your logs to detect potential abuse.

### 5. Rotate API Keys

Periodically rotate your API key, especially if it may have been exposed.

### 6. Use Production RPC Providers

Use paid RPC providers (Alchemy, Infura, Helius) for reliability and security.

### 7. Backup Encryption Key

Store your `ENCRYPTION_KEY` in a secure vault (AWS Secrets Manager, HashiCorp Vault).

---

## Reporting Vulnerabilities

If you discover a security vulnerability, please report it responsibly.
